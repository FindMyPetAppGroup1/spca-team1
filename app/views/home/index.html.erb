
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBXclu8PhDGVun2bDikmbNE5YUUNRFG204&callback=initMap"
 type="text/javascript"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src="https://cdn.klokantech.com/maptilerlayer/v1/index.js"></script>

<div class = 'container-fluid'>
  <div class="row">
    <!-- ðŸ‘‡ START OF SIDEBAR -->
    <div id='menu-main' class='sidebar nopadding col-xs-12 col-md-4'>
      <%= render 'my_reports' %>
      <% if user_signed_in? %>
        <section class='side-section side-user'>
          <% if current_user.avatar.present? %>
            <%= image_tag current_user.avatar %>
          <% end %>
          <%= current_user.full_name %>
        </section>
      <% end %>
      <p class="side-heading">Make a Report</p>
      <section id="button-newLost" class="side-section side-lost-report">
        <p class="side-links">Lost Pet</p>
      </section>
      <section id="button-newFound" class="side-section side-lost-report">
        <p class="side-links">Found/Sighted Pet</p>
      </section>
      <p class="side-heading">Account</p>
      <section id="button-listReport" class="side-section side-lost-report">
        <p class="side-links">My Report</p>
      </section>
      <section id="button-listMessage" class="side-section side-lost-report">
        <p class="side-links">Messages</p>
      </section>
      <section id="button-setting" class="side-section side-lost-report">
        <p class="side-links">Settings</p>
      </section>
      <section id="button-about" class="side-section side-lost-report">
        <p class="side-links">About find my pet</p>
      </section>
      <p class="side-footer"><%= fa_icon 'paw' %> Find my Pet V.01 </p>
    </div>
  </div>
    <!-- <section id="newReportLost">
      <div class="report-form-header">
        <a class="button-back"></a>
      </div>

      <button id="button-sumbitNewReportLost">Preview Your Report</button>
    </section> -->
    <!-- <section id="menu-main">
      <div id='userInfoData'>
      </div>

      <div>
      <label class='seperate'>MAKE A REPORT</label>
      </div>
      <div>
        <a id="button-newLost" href="#" class="btn btn-primary btn-block btn-lg">Lost Pet</a>
        <a id="button-newFound" href="#" class="btn btn-primary btn-block btn-lg">Found/Sighted Pet</a>
      </div>
      <div>
      <label class='seperate'>Account</label>
      </div>
      <div>
        <a id="button-listReport" href="#" class="btn btn-primary btn-block btn-lg">My Report</a>
        <a id="button-listMessage" href="#" class="btn btn-primary btn-block btn-lg">Messages</a>
        <a id="button-setting" href="#" class="btn btn-primary btn-block btn-lg">Settings</a>
        <a id="button-about" href="#" class="btn btn-primary btn-block btn-lg">About find my pet</a>
      </div>
    </section>

    <section id='listFilterdReport'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY Messages
      </div>
      <ul id='list-filterd'>
      </ul>
    </section>
    <section id='listReport'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      <label class='seperate'>LOST REPORT</label>
      <ul id='list-lost'>
      </ul>
      <label class='seperate'>FOUND REPORT</label>
      <ul id='list-found'>
      </ul>
    </section>
    <section id='listMessage'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY Messages
      </div>
      <label class='seperate'>Lost Pet</label>
      <ul id='list-message'>
      </ul>
    </section>
    <section id='setting'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> Setting
      </div>
      <a id="button-location" href="#" class="btn btn-primary btn-block btn-lg">Location</a>
      <a id="button-notification" href="#" class="btn btn-primary btn-block btn-lg">Notification</a>
      <a id="button-signout" href="#" class="btn btn-primary btn-block btn-lg">Sign Out</a>
    </section>
    <section id='about'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      ABOUT
    </section>

    <section id='newReportFound'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      <div class = 'ReportLostForm'>
        NEW REPORT
      </div>
      <a id="button-sumbitNewReportFound" href="#" class="btn btn-primary btn-block btn-lg">Preivew</a>
    </section>

    <section id='previewReportFound'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      <div id='previewReportFoundData'>

      </div>
      <a id="button-sumbitPreviewReportFound" href="#" class="btn btn-primary btn-block btn-lg">Comfirm</a>
    </section>

    <section id='completeReportFound'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      compelte
      <a id="button-sumbitCompleteReportFound" href="#" class="btn btn-primary btn-block btn-lg">Confirm</a>
    </section>
    <section id='showReportFound'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      <div id='showReportFoundData'>
      </div>
      <a id="button-reportAnotherFound" href="#" class="btn btn-primary btn-block btn-lg">Report</a>
      <a id="button-trackPet" href="#" class="btn btn-primary btn-block btn-lg">Track Pet</a>
      <a id="button-MessageFound" href="#" class="btn btn-primary btn-block btn-lg">Message</a>
    </section>
    <section id='editReportFound'>
    </section>

    <section id='newReportLost'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> MY REPORT
      </div>
      <div class = 'ReportLostForm'>
        NEW REPORT
      </div>
      <a id="button-sumbitNewReportLost" href="#" class="btn btn-primary btn-block btn-lg">Preivew</a>
    </section>

    <section id='previewReportLost'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      <div id='previewReportLostData'>
      </div>
      <a id="button-sumbitPreviewReportLost" href="#" class="btn btn-primary btn-block btn-lg">Confirm</a>
    </section>
    <section id='completeReportLost'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      complete
      <a id="button-sumbitCompleteReportLost" href="#" class="btn btn-primary btn-block btn-lg">Confirm</a>
    </section>
    <section id='showReportLost'>
      <div class='report-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      <div id='showReportLostData'>
      </div>
      <a id="button-MessageLost" href="#" class="btn btn-primary btn-block btn-lg">Message</a>
    </section>
    <section id='editReportLost'>
    </section>

    <section id='showMessage'>
      <div class='menu-control'>
        <a class='button-back'>BACK</a> Lost Pet
      </div>
      show Message
      <div class='messageData'>
      </div>
    </section>

    <section class='footnote'>
      <p>FindMyPet V1.0</p>

    <script id="showMessage" type="x-tmpl-mustache">
      <img src={{photo1}}>
      <p>{{body}}</p>
    </script>
    <script id="report-summary" type="x-tmpl-mustache">
      <li data-id={{id}}>
        <p>{{note}}</p>
        <hr>
      </li>
    </script>
    <script id="message-summary" type="x-tmpl-mustache">
      <li data-id={{id}}>
        <img src={{photo1}}>
        <p>{{body}}</p>
        <hr>
      </li>
    </script>

    <script id="reportShow" type="x-tmpl-mustache">
      <img data-id={{id}} scr={{photo}}>
      <p>Pet Type: {{pet_type}}</p>
      <p>Breed : {{breed}}</p>
      <p>Name : {{name}}</p>
      <p>Sex : {{sex}} </p>
      <p>Coulour : {{color}} </p>
      <p>Age : {{age}} </p>
      <p>Last Seen : {{last_seen_address}} </p>
      <p>Note : {{note}} </p>
    </script>

    <script id="user-info" type="x-tmpl-mustache">
      <div>
        <img src = {{avator}}>
        <p>Hello: {{first_name}}
      </div>
    </script>
  </div>

</div>
</div> -->

  <!-- ðŸ‘¨ MUSTACHE TEMPLATES -->

  <script id="showMessage" type="x-tmpl-mustache">
    <img src={{photo1}}>
    <p>{{body}}</p>
  </script>
  <script id="report-summary" type="x-tmpl-mustache">
    <li data-id={{id}}>
      <p>{{note}}</p>
      <hr>
    </li>
  </script>
  <script id="message-summary" type="x-tmpl-mustache">
    <li data-id={{id}}>
      <img src={{photo1}}>
      <p>{{body}}</p>
      <hr>
    </li>
  </script>

  <script id="reportShow" type="x-tmpl-mustache">
    <img data-id={{id}} scr={{photo}}>
    <p>Breed : {{breed}}</p>
    <p>Name : {{name}}</p>
    <p>Sex : {{sex}} </p>
    <p>Coulour : {{color}} </p>
    <p>Age : {{age}} </p>
    <p>Last Seen : {{last_seen_address}} </p>
    <p>Note : {{note}} </p>
  </script>

  <script id="user-info" type="x-tmpl-mustache">
    <div>
      <img src = {{avator}}>
      <p>Hello: {{first_name}}
    </div>
  </script>

<!-- ðŸ‘¨ END OF MUSTACHE TEMPLATES -->

<!-- ðŸ—º MAP VIEW -->

  <div class='map-view nopadding col-xs-12 col-md-8'>
    <div id="map-container">
      <div id="map-canvas"></div>
      <div id="legend"><h3>Pets</h3></div>
    </div>
  </div>
  <!-- END OF MAP VIEW -->

<script>
var addLegend = function () {
  var iconBase = '';
  var icons = {
    lost: {
      name: 'Lost',
      icon: iconBase + 'http://storage8.static.itmages.com/i/16/1120/h_1479684823_4696094_cedddc5c3a.png'
    },
    sighted: {
      name: 'Sighted',
      icon: iconBase + 'http://storage6.static.itmages.com/i/16/1120/h_1479684799_7772859_c01f214934.png'
    },
  };
  var legend = document.getElementById('legend');

  for (var key in icons) {
    console.log(key);
    var type = icons[key];
    var name = type.name;
    var icon = type.icon;
    var div = document.createElement('div');
    div.innerHTML = '<img src="' + icon + '"> ' + name;
    legend.appendChild(div);
  }
//
  map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
}

//create map
function initMap(){
  var latitude = 49.2827291;
  var longitude = -123.12073750000002;

  handler = Gmaps.build('Google');
  handler.buildMap({
      provider: {
        mapTypeControl: false,
        streetViewControl: false,
        zoom: 14,
        center: {lat: latitude, lng: longitude}

      },
      internal: {id: 'map-canvas'}}, function(){
    // markers = handler.addMarkers([
    //   {
    //     "lat": latitude,
    //     "lng": longitude,
    //     "picture": {
    //       "url": "http://people.mozilla.com/~faaborg/files/shiretoko/firefoxIcon/firefox-32.png",
    //       "width":  32,
    //       "height": 32
    //     },
    //     "infowindow": "hello!"
    //   }
    // ]);

    var markers = handler.addMarkers(<%=raw @markers.to_json %>);

    if(markers.length != 0){
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
     }
    map = (handler.map.serviceObject.data.map);
    var geoloccontrol = new klokantech.GeolocationControl(map, 18);
    // if(navigator.geolocation)
    //   navigator.geolocation.getCurrentPosition(displayOnMap);

    addLegend();
  });
}

// in listener
//

</script>
